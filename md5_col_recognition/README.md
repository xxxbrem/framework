# MD5 Collision Recognition

## Introduction

This code is for collision recognition via DL methods.

`./data/xxx_xpc`: csv files for training and testing.

`./data/clean_data_dir`: 2 different clean files. 

`./data/collision_data_dir/xxx_xpc`: ipc or cpc generated by hashclash. We have log files for collision data. TEST_ipc is for the negative label.

`./models/xxx.coll`: collision example

## Data

We offer some necessary clean and collided data. Folder `./data/clean_data_dir` could be found at https://1drv.ms/u/s!ApgPP_gi8tv8kyAoD0I5ncUXjp-1?e=GaiDbg. Folder `./data/collision_data_dir` could be found at https://1drv.ms/u/s!ApgPP_gi8tv8kxwdYIUDcMVVOapx?e=Z0fbK2. Folder `./models` could be found at https://1drv.ms/u/s!ApgPP_gi8tv8kx2GnxBEWHbo2tsq?e=KBxFgZ. Or you can get the collision data by yourself through [hashclash](https://github.com/cr-marcstevens/hashclash).

## Requirements

Run `pip install -r requirements.txt`.
For BERT, create a new environment, `pip install transformers`.

## Results for BERT

Get training and testing data:

`./scripts/get_data.sh BERT BERT BERT_cpc`
`./scripts/get_data.sh vit vit vit_cpc`
`./scripts/get_data.sh pic pic pic_ipc`
`./scripts/get_data.sh txt txt txt_ipc`

Get detection data:

`./scripts/get_detection_data.sh vit vit_cpc` or
`./scripts/get_detection_dataJS.sh vit vit_cpc` 

`./scripts/get_detection_data.sh BERT BERT_cpc` or
`./scripts/get_detection_dataJS.sh BERT BERT_cpc` 

`./scripts/get_detection_data.sh pic pic_ipc` or
`./scripts/get_detection_dataJS.sh pic pic_ipc`

`./scripts/get_detection_data.sh txt txt_ipc` or
`./scripts/get_detection_dataJS.sh txt txt_ipc`

`cd text-classification`
Place the training and testing files in `tmp_data`, and rename them as `dev.csv`, `train.csv`.
Run:
```
python run_glue.py \
  --model_name_or_path bert-base-cased \
  --dataset_name tmp_data \
  --do_train \
  --do_eval \
  --max_seq_length 128 \
  --per_device_train_batch_size 32 \
  --learning_rate 2e-5 \
  --num_train_epochs 3 \
  --output_dir ./output \
  --overwrite_output_dir \
  --seed 1234
```
for fine-tuning and testing.

## Results for LSTM

1. train and test

    Train BERT defense model and test:

    `./scripts/prediction.sh BERT BERT BERT_cpc`

    Train ViT defense model and test:

    `./scripts/prediction.sh vit vit vit_cpc`

    Train Pic defense model and test:

    `./scripts/prediction.sh pic pic pic_ipc`

    Train Txt defense model and test:
    `./scripts/prediction.sh txt txt txt_ipc`

2. test only

    Normal test:
    
    `./scripts/test.sh BERT_cpc BERT_cpc`

    `./scripts/test.sh vit_cpc vit_cpc`
    
    `./scripts/test.sh pic_ipc pic_ipc`
    
    `./scripts/test.sh txt_ipc txt_ipc`

    Transfer test:
    
    `./scripts/test.sh vit_cpc BERT_cpc`
    
    `./scripts/test.sh BERT_cpc vit_cpc`
    
    `./scripts/test.sh BERT_cpc pic_ipc`
    
    `./scripts/test.sh pic_ipc BERT_cpc`
    
    `./scripts/test.sh vit_cpc pic_ipc`
    
    `./scripts/test.sh pic_ipc vit_cpc`
    
    `./scripts/test.sh pic_ipc txt_ipc`
    
    `./scripts/test.sh txt_ipc pic_ipc`
    
    `./scripts/test.sh txt_ipc vit_cpc`
    
    `./scripts/test.sh vit_cpc txt_ipc`
    
    `./scripts/test.sh BERT_cpc txt_ipc`
    
    `./scripts/test.sh txt_ipc BERT_cpc`

3. detection

    Detection:
    (NonJS ans JS)

    `./scripts/detection.sh vit vit_cpc` 
    `./scripts/detectionJS.sh vit vit_cpc`

    `./scripts/detection.sh BERT BERT_cpc`
    `./scripts/detectionJS.sh BERT BERT_cpc` 

    `./scripts/detection.sh pic pic_ipc`
    `./scripts/detectionJS.sh pic pic_ipc`

    `./scripts/detection.sh txt txt_ipc`
    `./scripts/detectionJS.sh txt txt_ipc`